# Vulture Egg Data Visualization

## Introduction

Vulture Egg Data Visualization Website is used to display the data captured by smart egg in real time.
It is developed in PHP and JavaScript, used WegGL three.js, Bootstrap, jQuery and D3.

## Install

### Prerequisite

* Installed PHP with Apache or Nginx
* A MySQL instance. Here is the [SQL to generate database schema](https://github.com/guoxiangyang/VultureEgg/blob/master/Projects/RaspberryPi/mysql.sql)

### Deployment

Copy the files under the folder of "website" to www root folder of PHP. Then you can view pages from browser.

Sample : [Vulture Egg](http://egg.clouduino.cc/)

### Config

You can modify `config.php` to config some environment variables.

Here is a sample of config.php:

    "mysql_host"=>"YourMySQLHost",      // such as localhost or localhost:3306
    "mysql_username"=>"mysqlUser",      // mysql user can READ the vulture egg schema
    "mysql_password"=>"mysqlPassword",  // mysql password
    "mysql_database"=>"egg",            // database schema name

    "egg_id"=>"BC6A29BD0E5C",           // default egg_id, used by data_current.php
    "pi_id"=>"02:10:08:41:50:74"        // default pi_id, used by data_current.php

## Server Customization

### Color Map

Open `index.html` , find the code as follow:

    // ******************
    // Setting, these variable defined in vultureegg.js

    colorMap = 'rainbow';   // "rainbow", "cooltowarm", "blackbody", "grayscale"
    temperature_max = 46;   // This is the max value of lut color map.
    temperature_min = 20;   // This is the min value of lut color map.

There are four type of color map which defined at the end of 'static/js/Lut.js' :

    THREE.ColorMapKeywords = {

        "rainbow": [
            [ 0.0, '0x0000FF' ],
            [ 0.2, '0x00FFFF' ],
            [ 0.5, '0x00FF00' ],
            [ 0.8, '0xFFFF00'],
            [1.0, '0xFF0000' ]
        ],
        "cooltowarm": [
            [ 0.0, '0x3C4EC2' ],
            [ 0.2, '0x9BBCFF' ],
            [ 0.5, '0xDCDCDC' ],
            [ 0.8, '0xF6A385'],
            [1.0, '0xB40426' ]
        ],
        "blackbody": [
            [ 0.0, '0x000000' ],
            [ 0.2, '0x780000' ],
            [ 0.5, '0xE63200' ],
            [ 0.8, '0xFFFF00'],
            [1.0, '0xFFFFFF' ]
        ],
        "grayscale": [
            [ 0.0, '0x000000' ],
            [ 0.2, '0x404040' ],
            [ 0.5, '0x7F7F80' ],
            [ 0.8, '0xBFBFBF'],
            [1.0, '0xFFFFFF' ]
        ]

    };

### Render Type

Open `index.html` , find the code as follow:

    // ******************
    // Setting, these variable defined in vultureegg.js
    ...
    render_type = RENDER_EGG;  // RENDER_EGG, RENDER_LIGHT, RENDER_COLOR

There are three render types:

* RENDER_EGG, default type, display as egg shell
* RENDER_LIGHT, simulate temperature color by light in color map. You can switch to this type by the checkbox named as 'rendering'. It displays th INNER surface of egg.
* RENDER_COLOR, it will display some solid color ranges on the egg surface, each range contains one temperature sensor.

## Temperature Sensor Position

* Top of Egg(Small End) : "Temp-01"
* Level 1 (Rotated from X-Axis by Pi/2 ) : "Temp-02", "Temp-03", "Temp-04", "Temp-05"
* Level 2 (Rotated from X-Axis by Pi/2 ) : "Temp-06", "Temp-07", "Temp-08", "Temp-09"
* Level 3 (Rotated from X-Axis by Pi/2 ) : "Temp-10", "Temp-11", "Temp-12", "Temp-13"
* Bottom of Egg(Big End) : : "Temp-14"

## Data Service

`index.html` use the data service generated by `data_current.php`:

    var json_file = 'data_current.php'; // Use default egg_id & pi_id defined in config.php

This data service can be GET with params:

    var json_file = 'data_current.php?egg_id=xx&pi_id=yy' ;

The data service return a JSON as follow:

    {"data": {
        "mpu_time": "2014-09-15 18:59:58",
        "acc_x": "-208",
        "acc_y": "-148",
        "acc_z": "-17770",
        "quaternion_0": "29",
        "quaternion_1": "-14422",
        "quaternion_2": "-7774",
        "quaternion_3": "125",
        "temp_time": "2014-09-15 18:59:03",
        "temp_01": "28.120",
        "temp_02": "27.000",
        "temp_03": "25.690",
        "temp_04": "26.370",
        "temp_05": "26.440",
        "temp_06": "26.120",
        "temp_07": "25.750",
        "temp_08": "26.060",
        "temp_09": "26.060",
        "temp_10": "25.870",
        "temp_11": "26.810",
        "temp_12": "25.940",
        "temp_13": "25.870",
        "temp_14": "26.620",
        "hum_time": "2014-09-15 18:59:58",
        "humidity": "27.400",
        "weather_time": "2014-09-15 18:59:58",
        "weather_hum": "21.430",
        "light": "8.000",
        "pressure": "10104",
        "temperature": "32.630",
        "avg_temp": "26.337"
    }, "msg": "", "state": 1}

## Browser Compatibility

Tested on Firefox, Chrome, and Safari on PC.

If your browser can't support WebGL, you can see the data in text, but can't see the egg.

### FireFox

It works.

### Chrome

You should enable WebGL.

If you can't look the egg, please input `chrome://flags` in the address bar, and setting the param of Disable WebGL with false.

On iPad or iPhone, `chrome://flags` will return empty list, so we can't see the egg. It seems iphon 6 or iOS 8 can enable WebGL.

On some Android device, `chrome://flags` has this param.

### Safari

In Safari, open the Safari menu and select `Preferences`. Then, click the `Advanced` tab in the Preferences window.

Then, at the bottom of the window, check the `Show Develop menu in menu bar checkbox`.

Then, open the `Develop` menu in the menu bar and select `Enable WebGL`.

## Contact Me

Any question, please contact me.

Email : iascchen@gmail.com
